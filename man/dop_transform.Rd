% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/input_wrapper.R
\name{dop_transform}
\alias{dop_transform}
\title{Transform AEC distribution of preferences from long to wide format}
\usage{
dop_transform(
  data,
  key_cols,
  value_col,
  alternative_col,
  normalize = TRUE,
  scale = 1,
  fill_value = 0,
  winner_col = NULL,
  winner_identifier = "Y"
)
}
\arguments{
\item{data}{A data frame containing preference or vote distribution data, with format similar to
\link[AEC Distribution of Preferences]{https://results.aec.gov.au/31496/Website/Downloads/HouseDopByDivisionDownload-31496.csv}}

\item{key_cols}{Columns that identify unique observations, e.g., DivisionNm, CountNumber}

\item{value_col}{Numeric and non-negative. Column containing the numeric values to aggregate,
e.g., CalculationValue, Votes.}

\item{alternative_col}{Column name containing the alternative of the election,
e.g., Party, Candidate. This column will become column names in the output wide format.}

\item{normalize}{Logical. If \code{TRUE} (default), normalizes values within
each group to sum to 1. If \code{FALSE}, returns raw aggregated values.}

\item{scale}{Numeric. If \code{normalize = FALSE}, divides all values by this
scale factor. Default is 1 (no scaling).}

\item{fill_value}{Numeric. Value to use for missing combinations after
pivoting. Default is 0.}

\item{winner_col}{Optional character string specifying a column that indicates
the winner/elected party. If provided, this column will be joined back to
the output based on key columns. Useful for preserving election outcome
information. Default is \code{NULL}.}

\item{winner_identifier}{Optional character string specifying the value in
\code{winner_col} that identifies winning candidates (e.g., "Y", "Elected").
Only used if \code{winner_col} is specified. Default is "Y".}
}
\value{
A data frame in wide format with:
\itemize{
\item Key columns identifying each observation
\item Columns for each alternative containing aggregated/normalized values
\item Winner column (if \code{winner_col} was specified)
}
}
\description{
Transform AEC distribution of preferences from long to wide format, with optional scaling and normalization.
This function is useful for converting all distribution of preference data with similar format
into format ready for ternary plots.
}
\examples{
# Convert AEC 2025 Distribution of Preference data to wide format
data(aec_dop_2025)

# We are interested in the preferences of Labor, Coalition, Greens and Independent. 
# The rest of the parties are aggregated as Other.
aec_dop_2025 <- aec_dop_2025 |>
 filter(CalculationType == "Preference Percent") |> 
  mutate(PartyAb = case_when(
    !(PartyAb \%in\% c("LP", "ALP", "NP", "LNP", "LNQ")) ~ "Other",
    PartyAb \%in\% c("LP", "NP", "LNP", "LNQ") ~ "LNP",
   TRUE ~ PartyAb))

dop_transform(
  data = aec_dop_2025,
  key_cols = DivisionNm, CountNumber,
  value_col = CalculationValue,
  alternative_col = Party,
  winner_col = Elected
)
}
